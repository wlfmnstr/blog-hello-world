---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog', ({ data }) => {
    return data.draft !== true;
  });
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

function formatDate(date: Date): string {
  return new Date(date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<MainLayout title={entry.data.title} description={entry.data.description}>
  <article class="container mx-auto px-4 py-12 max-w-3xl">
    <div class="space-y-4 mb-8">
      <a
        href="/blog"
        class="inline-flex items-center text-sm text-muted-foreground hover:text-foreground transition-colors"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="mr-2"
        >
          <path d="m15 18-6-6 6-6" />
        </svg>
        Back to Blog
      </a>
      <h1 class="text-4xl font-bold">{entry.data.title}</h1>
      <div class="flex items-center gap-2 text-sm text-muted-foreground">
        <time datetime={entry.data.pubDate.toISOString()}>
          {formatDate(entry.data.pubDate)}
        </time>
        <span>Â·</span>
        <span>{entry.data.author}</span>
      </div>
      {entry.data.tags && entry.data.tags.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {entry.data.tags.map((tag) => (
            <span class="inline-flex items-center rounded-full bg-secondary px-2.5 py-0.5 text-xs font-medium text-secondary-foreground">
              {tag}
            </span>
          ))}
        </div>
      )}
    </div>

    <div class="prose prose-lg max-w-none">
      <Content />
    </div>
  </article>
</MainLayout>
